<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-TYPE: Level Parsing Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">R-TYPE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Level Parsing Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overview"></a>
Overview</h1>
<p>This document details the implementation of level parsing in the game server, specifically how the server loads and processes level configuration files. These files are JSON formatted and define entities along with their components for each level.</p>
<h1><a class="anchor" id="loadLevel"></a>
Loading Levels</h1>
<p>The <code>loadLevel</code> function is responsible for loading level configuration from a JSON file. It processes each JSON object to create entities with the specified components.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classServer.html#ac2c3d5a5795897aa34370aa52faf9edf">Server::loadLevel</a>(<span class="keyword">const</span> std::string&amp; levelConfig) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="keyword">auto</span> jsonArray = <a class="code" href="levels_8cpp.html#a587c0d3e456e44c160c8dbbf14bb895c">loadJsonData</a>(levelConfig);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; jsonObj : jsonArray) {</div>
<div class="line">            <a class="code" href="classServer.html#a74dacf4f48326733f605b6a8b254067f">processJsonObject</a>(jsonObj);</div>
<div class="line">        }</div>
<div class="line">        init_enemies();</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Error loading level: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassServer_html_a74dacf4f48326733f605b6a8b254067f"><div class="ttname"><a href="classServer.html#a74dacf4f48326733f605b6a8b254067f">Server::processJsonObject</a></div><div class="ttdeci">void processJsonObject(const nlohmann::json &amp;jsonObj)</div><div class="ttdoc">Processes a JSON object and creates the corresponding entity and components.</div><div class="ttdef"><b>Definition:</b> levels.cpp:204</div></div>
<div class="ttc" id="aclassServer_html_ac2c3d5a5795897aa34370aa52faf9edf"><div class="ttname"><a href="classServer.html#ac2c3d5a5795897aa34370aa52faf9edf">Server::loadLevel</a></div><div class="ttdeci">void loadLevel(const std::string &amp;levelConfig)</div><div class="ttdoc">Loads a level from a JSON file.</div><div class="ttdef"><b>Definition:</b> levels.cpp:229</div></div>
<div class="ttc" id="alevels_8cpp_html_a587c0d3e456e44c160c8dbbf14bb895c"><div class="ttname"><a href="levels_8cpp.html#a587c0d3e456e44c160c8dbbf14bb895c">loadJsonData</a></div><div class="ttdeci">nlohmann::json loadJsonData(const std::string &amp;filename)</div><div class="ttdoc">Loads a JSON file.</div><div class="ttdef"><b>Definition:</b> levels.cpp:189</div></div>
</div><!-- fragment --><h1><a class="anchor" id="processJsonObject"></a>
Processing JSON Objects</h1>
<p>The <code>processJsonObject</code> function iterates over each element in a JSON object, identifies the component type, and creates the respective components for an entity.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classServer.html#a74dacf4f48326733f605b6a8b254067f">Server::processJsonObject</a>(<span class="keyword">const</span> nlohmann::json&amp; jsonObj) {</div>
<div class="line">    <span class="keyword">auto</span> entity = _ecs.<a class="code" href="classECS.html#a41b876f3725cbb04aac3f2edd95522c6">createEntity</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; element : jsonObj.items()) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; componentType = element.key();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; componentData = element.value();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (_componentFactories.find(componentType) != _componentFactories.end()) {</div>
<div class="line">            std::unordered_map&lt;std::string, std::string&gt; params;</div>
<div class="line">            <span class="keywordflow">if</span> (componentData.is_primitive()) {</div>
<div class="line">                params[componentType] = componentData.get&lt;std::string&gt;();</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; nestedElement : componentData.items()) {</div>
<div class="line">                    params[nestedElement.key()] = nestedElement.value().get&lt;std::string&gt;();</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            _componentFactories[componentType](entity, params);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassECS_html_a41b876f3725cbb04aac3f2edd95522c6"><div class="ttname"><a href="classECS.html#a41b876f3725cbb04aac3f2edd95522c6">ECS::createEntity</a></div><div class="ttdeci">Entity createEntity()</div><div class="ttdoc">Creates a new entity.</div><div class="ttdef"><b>Definition:</b> ECS.hpp:47</div></div>
</div><!-- fragment --><h1><a class="anchor" id="componentCreation"></a>
Component Creation</h1>
<p>Component creation functions such as <code>createPlayerComponent</code>, <code>createPositionComponent</code>, etc., are used to add specific components to entities. These functions parse parameters from the JSON object and apply them to the components. Example of a component creation function: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classServer.html#a60d5d6dd570ce49fb2b5ec9f49d3b330">Server::createPositionComponent</a>(ECS::Entity entity, <span class="keyword">const</span> std::unordered_map&lt;std::string, std::string&gt;&amp; params) {</div>
<div class="line">    <span class="keywordflow">if</span> (params.find(<span class="stringliteral">&quot;x&quot;</span>) != params.end() &amp;&amp; params.find(<span class="stringliteral">&quot;y&quot;</span>) != params.end()) {</div>
<div class="line">        <span class="keywordtype">float</span> x = std::stof(params.at(<span class="stringliteral">&quot;x&quot;</span>));</div>
<div class="line">        <span class="keywordtype">float</span> y = std::stof(params.at(<span class="stringliteral">&quot;y&quot;</span>));</div>
<div class="line">        _ecs.<a class="code" href="classECS.html#a3e470b32582ec8a6943017d143ceed73">addComponent</a>(entity, <a class="code" href="structPosition.html">Position</a>{x, y});</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Position component requires both &#39;X&#39; and &#39;Y&#39; parameters.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassECS_html_a3e470b32582ec8a6943017d143ceed73"><div class="ttname"><a href="classECS.html#a3e470b32582ec8a6943017d143ceed73">ECS::addComponent</a></div><div class="ttdeci">void addComponent(Entity entity, T component)</div><div class="ttdoc">Adds a component to an entity.</div><div class="ttdef"><b>Definition:</b> ECS.hpp:72</div></div>
<div class="ttc" id="aclassServer_html_a60d5d6dd570ce49fb2b5ec9f49d3b330"><div class="ttname"><a href="classServer.html#a60d5d6dd570ce49fb2b5ec9f49d3b330">Server::createPositionComponent</a></div><div class="ttdeci">void createPositionComponent(ECS::Entity entity, const std::unordered_map&lt; std::string, std::string &gt; &amp;params)</div><div class="ttdoc">Create a Position Component object.</div><div class="ttdef"><b>Definition:</b> levels.cpp:107</div></div>
<div class="ttc" id="astructPosition_html"><div class="ttname"><a href="structPosition.html">Position</a></div><div class="ttdoc">Position component.</div><div class="ttdef"><b>Definition:</b> components.hpp:35</div></div>
</div><!-- fragment --><h1><a class="anchor" id="errorHandling"></a>
Error Handling</h1>
<p>Error handling is implemented within each component creation function, ensuring that all required parameters are provided. If a parameter is missing, an error message is logged to the standard error stream.</p>
<h1><a class="anchor" id="loadJsonData"></a>
JSON File Loading</h1>
<p>The <code>loadJsonData</code> function is responsible for reading the level configuration file, parsing it into a JSON object, and returning it for further processing. </p><div class="fragment"><div class="line">nlohmann::json <a class="code" href="levels_8cpp.html#a587c0d3e456e44c160c8dbbf14bb895c">loadJsonData</a>(<span class="keyword">const</span> std::string&amp; filename) {</div>
<div class="line">    std::ifstream file(filename);</div>
<div class="line">    <span class="keywordflow">if</span> (!file.is_open()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Failed to open file: &quot;</span> + filename);</div>
<div class="line">    }</div>
<div class="line">    nlohmann::json jsonArray;</div>
<div class="line">    file &gt;&gt; jsonArray;</div>
<div class="line">    <span class="keywordflow">return</span> jsonArray;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="conclusion"></a>
Conclusion</h1>
<p>This level parsing implementation provides a flexible and efficient way to load and configure game levels using JSON files. It allows for dynamic creation of entities with various components, facilitating rich and varied game environments. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
